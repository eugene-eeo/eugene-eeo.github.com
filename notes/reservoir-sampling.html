<!doctype html><meta charset=utf-8><style>body{font-family:Georgia,serif;font-size:16px;width:35em;margin:3em auto}code,pre{font-family:Inconsolata,Menlo,Consolas,monospace}li{margin:.5em 0}.has-jax{font:inherit;font-size:90%}h1,h2,h3{font-weight:400}hr{background-color:#000;border:0;height:1px}.footnotes{margin-top:5em;font-size:.75em}table{border-collapse:collapse}th{background-color:#EEE}td,th{border:1px solid #000;padding:.2em .5em}</style><title>Reservoir sampling</title><h1>Reservoir sampling</h1><p><strong>Problem:</strong> given a sequence of <code>$ n $</code> elements, sample <code>$ k $</code> elements such that each datum in the sample is selected with equal probability.<p><strong>Solution:</strong> for any <code>$ i $</code>th element in the sequence <code>$ S $</code>, assume that we already have <code>$ k $</code> elements in the reservoir. Then add it to the reservoir with probability <code>$ \frac{k}{i} $</code>. This may overflow the reservoir, so if the element is added, an existing element must be removed from the reservoir with probability <code>$ \frac{1}{k} $</code>. The probability that an element will remain in the reservoir is:<p><code>$$ 1 - \frac{k}{i} + \frac{k}{i} (1 - \frac{1}{k}) = \frac{i-1}{i} $$</code><p>By assumption, prob. of element being inside the reservoir is <code>$ \frac{k}{i-1} $</code>. So the probability of an element being sampled (i.e. being in the reservoir) is:<p><code>$$ \frac{i-1}{i} \frac{k}{i-1} = \frac{k}{i} $$</code></p><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.js></script><script>!function(){function e(e){var t=e.match(a);return t?{TeX:t[1]||t[2],displayMode:!!t[1]}:null}for(var t=document.getElementsByTagName("code"),a=/(?:^\$\$\s*([\s\S]+)\s*\$\$$)|(?:^\$\s*([\s\S]+)\s*\$$)/,s=t.length;s--;){var n=t[s],r=e(n.textContent);r&&(katex.render(r.TeX,n,{displayMode:r.displayMode,throwOnError:!1}),n.classList.add("has-jax"))}}()</script>