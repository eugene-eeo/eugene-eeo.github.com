evee=function(){var e=/click|mouse(down|up|move)/,n=/key(down|up|press)/;return{on:function(e,n,t){return e.addEventListener(n,t),t},off:function(e,n,t){e.removeEventListener(n,t)},fire:function(t,o){var r=e.test(o)?MouseEvent:n.test(o)?KeyboardEvent:Event;t.dispatchEvent(new r(o,{bubbles:!0,cancelable:!0}))}}}();nut=function(e,t){return t=nut.el(t),[].slice.call(/^\.[\w\-]+$/.test(e)?t.getElementsByClassName(e.slice(1)):t.querySelectorAll(e))},nut.el=function(e,t){return"string"!=typeof e?e||document:(t=nut.el(t),/^#[\w\-]+$/.test(e)&&t.getElementById?t.getElementById(e.slice(1)):t.querySelector(e))};(function(root,factory){if(typeof exports==="object"){var randomColor=factory();if(typeof module==="object"&&module&&module.exports){exports=module.exports=randomColor}exports.randomColor=randomColor}else if(typeof define==="function"&&define.amd){define([],factory)}else{root.randomColor=factory()}})(this,function(){var seed=null;var colorDictionary={};loadColorBounds();var randomColor=function(options){options=options||{};if(options.seed!==undefined&&options.seed!==null&&options.seed===parseInt(options.seed,10)){seed=options.seed}else if(typeof options.seed==="string"){seed=stringToInteger(options.seed)}else if(options.seed!==undefined&&options.seed!==null){throw new TypeError("The seed value must be an integer or string")}else{seed=null}var H,S,B;if(options.count!==null&&options.count!==undefined){var totalColors=options.count,colors=[];options.count=null;while(totalColors>colors.length){if(seed&&options.seed)options.seed+=1;colors.push(randomColor(options))}options.count=totalColors;return colors}H=pickHue(options);S=pickSaturation(H,options);B=pickBrightness(H,S,options);return setFormat([H,S,B],options)};function pickHue(options){var hueRange=getHueRange(options.hue),hue=randomWithin(hueRange);if(hue<0){hue=360+hue}return hue}function pickSaturation(hue,options){if(options.hue==="monochrome"){return 0}if(options.luminosity==="random"){return randomWithin([0,100])}var saturationRange=getSaturationRange(hue);var sMin=saturationRange[0],sMax=saturationRange[1];switch(options.luminosity){case"bright":sMin=55;break;case"dark":sMin=sMax-10;break;case"light":sMax=55;break}return randomWithin([sMin,sMax])}function pickBrightness(H,S,options){var bMin=getMinimumBrightness(H,S),bMax=100;switch(options.luminosity){case"dark":bMax=bMin+20;break;case"light":bMin=(bMax+bMin)/2;break;case"random":bMin=0;bMax=100;break}return randomWithin([bMin,bMax])}function setFormat(hsv,options){switch(options.format){case"hsvArray":return hsv;case"hslArray":return HSVtoHSL(hsv);case"hsl":var hsl=HSVtoHSL(hsv);return"hsl("+hsl[0]+", "+hsl[1]+"%, "+hsl[2]+"%)";case"hsla":var hslColor=HSVtoHSL(hsv);var alpha=options.alpha||Math.random();return"hsla("+hslColor[0]+", "+hslColor[1]+"%, "+hslColor[2]+"%, "+alpha+")";case"rgbArray":return HSVtoRGB(hsv);case"rgb":var rgb=HSVtoRGB(hsv);return"rgb("+rgb.join(", ")+")";case"rgba":var rgbColor=HSVtoRGB(hsv);var alpha=options.alpha||Math.random();return"rgba("+rgbColor.join(", ")+", "+alpha+")";default:return HSVtoHex(hsv)}}function getMinimumBrightness(H,S){var lowerBounds=getColorInfo(H).lowerBounds;for(var i=0;i<lowerBounds.length-1;i++){var s1=lowerBounds[i][0],v1=lowerBounds[i][1];var s2=lowerBounds[i+1][0],v2=lowerBounds[i+1][1];if(S>=s1&&S<=s2){var m=(v2-v1)/(s2-s1),b=v1-m*s1;return m*S+b}}return 0}function getHueRange(colorInput){if(typeof parseInt(colorInput)==="number"){var number=parseInt(colorInput);if(number<360&&number>0){return[number,number]}}if(typeof colorInput==="string"){if(colorDictionary[colorInput]){var color=colorDictionary[colorInput];if(color.hueRange){return color.hueRange}}else if(colorInput.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var hue=HexToHSB(colorInput)[0];return[hue,hue]}}return[0,360]}function getSaturationRange(hue){return getColorInfo(hue).saturationRange}function getColorInfo(hue){if(hue>=334&&hue<=360){hue-=360}for(var colorName in colorDictionary){var color=colorDictionary[colorName];if(color.hueRange&&hue>=color.hueRange[0]&&hue<=color.hueRange[1]){return colorDictionary[colorName]}}return"Color not found"}function randomWithin(range){if(seed===null){return Math.floor(range[0]+Math.random()*(range[1]+1-range[0]))}else{var max=range[1]||1;var min=range[0]||0;seed=(seed*9301+49297)%233280;var rnd=seed/233280;return Math.floor(min+rnd*(max-min))}}function HSVtoHex(hsv){var rgb=HSVtoRGB(hsv);function componentToHex(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex}var hex="#"+componentToHex(rgb[0])+componentToHex(rgb[1])+componentToHex(rgb[2]);return hex}function defineColor(name,hueRange,lowerBounds){var sMin=lowerBounds[0][0],sMax=lowerBounds[lowerBounds.length-1][0],bMin=lowerBounds[lowerBounds.length-1][1],bMax=lowerBounds[0][1];colorDictionary[name]={hueRange:hueRange,lowerBounds:lowerBounds,saturationRange:[sMin,sMax],brightnessRange:[bMin,bMax]}}function loadColorBounds(){defineColor("monochrome",null,[[0,0],[100,0]]);defineColor("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]);defineColor("orange",[19,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]);defineColor("yellow",[47,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]);defineColor("green",[63,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]);defineColor("blue",[179,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]);defineColor("purple",[258,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]);defineColor("pink",[283,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function HSVtoRGB(hsv){var h=hsv[0];if(h===0){h=1}if(h===360){h=359}h=h/360;var s=hsv[1]/100,v=hsv[2]/100;var h_i=Math.floor(h*6),f=h*6-h_i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),r=256,g=256,b=256;switch(h_i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break}var result=[Math.floor(r*255),Math.floor(g*255),Math.floor(b*255)];return result}function HexToHSB(hex){hex=hex.replace(/^#/,"");hex=hex.length===3?hex.replace(/(.)/g,"$1$1"):hex;var red=parseInt(hex.substr(0,2),16)/255,green=parseInt(hex.substr(2,2),16)/255,blue=parseInt(hex.substr(4,2),16)/255;var cMax=Math.max(red,green,blue),delta=cMax-Math.min(red,green,blue),saturation=cMax?delta/cMax:0;switch(cMax){case red:return[60*((green-blue)/delta%6)||0,saturation,cMax];case green:return[60*((blue-red)/delta+2)||0,saturation,cMax];case blue:return[60*((red-green)/delta+4)||0,saturation,cMax]}}function HSVtoHSL(hsv){var h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,k=(2-s)*v;return[h,Math.round(s*v/(k<1?k:2-k)*1e4)/100,k/2*100]}function stringToInteger(string){var total=0;for(var i=0;i!==string.length;i++){if(total>=Number.MAX_SAFE_INTEGER)break;total+=string.charCodeAt(i)}return total}return randomColor});function Position(x,y,normalized){this.x=x;this.y=y;this.normalized=normalized||false}Position.from_raw=function(raw){return new Position(raw.x,raw.y,true)};Position.prototype={raw:function(){return{x:this.x,y:this.y}},scale:function(box){return new Position(this.x*box.width,this.y*box.height,false)},normalize:function(box){return new Position(this.x/box.width,this.y/box.height,true)},distance:function(other){if(!this.normalized||!other.normalized){throw Error("both need to be normalized")}return Math.sqrt(Math.pow(this.x-other.x,2)+Math.pow(this.y-other.y,2))}};!function(){var $=nut;var API_KEY="6OFj3giYGF0pnDqa";var MAX_DIST=.1;var canvas=$.el("#space");canvas.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;canvas.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;if(window.location.hash.length===0){var h=randomColor().substr(1);window.location.hash=h}var room_id=window.location.hash.substr(1);var uuid=randomColor({hue:"red",format:"hex"}).substr(1);var room=null;var shouldVibrate=false;var vibrateStart=null;var startpos=null;var drone=new Scaledrone(API_KEY);drone.on("open",function(error){if(error){$.el("#error").textContent="An error has occured. Please try again by reload the page.";return}room=drone.subscribe(room_id);room.on("open",function(err){bindEvents()});var last_pos=null;var peer_pos=null;var ctx=canvas.getContext("2d");room.on("data",function(data){var pos=data.pos?Position.from_raw(data.pos):null;if(data.uuid===uuid){last_pos=pos}else{peer_pos=pos}if(pos)drawCircle(ctx,pos,"#"+data.uuid);if(peer_pos&&last_pos&&peer_pos.distance(last_pos)<=MAX_DIST){navigator.vibrate(100);shouldVibrate=true;vibrateStart=(new Date).getTime();startpos=last_pos}else{shouldVibrate=false}setInterval(function(){startVibrate(ctx)},0)})});var interval=null;function startVibrate(ctx){if(!shouldVibrate){document.body.style.backgroundColor="#fff";clearInterval(interval);return}var dt=(new Date).getTime()-vibrateStart;var scale=Math.ceil(dt/500);var opacity=scale/10;document.body.style.backgroundColor="rgba(222, 93, 131, "+opacity+")";if(opacity>=1){var box=ctx.canvas.getBoundingClientRect();var pos=startpos.scale(box);var el=document.createElement("img");el.classList.add("heart");el.src="/static/kiss.png";el.style.width=90+"px";el.style.height=90+"px";el.style.left=pos.x-45+"px";el.style.top=pos.y-45+"px";document.body.insertBefore(el,canvas);document.body.style.backgroundColor="#fff";shouldVibrate=false}interval=setInterval(function(){startVibrate(ctx)},500)}function sendTouchPosition(pos){drone.publish({room:room_id,message:{uuid:uuid,pos:pos}})}function bindEvents(){evee.on(canvas,"touchstart",function(e){var event=e.changedTouches[e.changedTouches.length-1];var pos=new Position(event.pageX,event.pageY);var box=canvas.getBoundingClientRect();sendTouchPosition(pos.normalize(box).raw())});evee.on(canvas,"touchcancel",evee.on(canvas,"touchend",function(e){sendTouchPosition(null)}))}function drawCircle(ctx,pos,color){var box=ctx.canvas.getBoundingClientRect();pos=pos.scale(box);ctx.beginPath();ctx.arc(pos.x,pos.y,MAX_DIST*box.width,0,2*Math.PI);ctx.strokeStyle=color;ctx.stroke()}}();
